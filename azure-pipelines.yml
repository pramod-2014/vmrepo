trigger:
  branches:
    include:
      - main   # jab main branch me push hoga tab pipeline chalega

variables:
  ARM_CLIENT_ID: $(ARM_CLIENT_ID)
  ARM_CLIENT_SECRET: $(ARM_CLIENT_SECRET)
  ARM_SUBSCRIPTION_ID: $(ARM_SUBSCRIPTION_ID)
  ARM_TENANT_ID: $(ARM_TENANT_ID)

stages:
  - stage: Deploy_VM
    displayName: "Terraform Apply - Create Azure VM"
    jobs:
      - job: Terraform_Apply
        displayName: "Apply Terraform Code"
        pool:
          vmImage: 'ubuntu-latest'
        steps:

          - task: TerraformInstaller@1
            displayName: "Install Terraform"
            inputs:
              terraformVersion: '1.5.0'

          - script: terraform init
            displayName: "Terraform Init"

          - script: terraform validate
            displayName: "Terraform Validate"

          - script: terraform plan -out=tfplan
            displayName: "Terraform Plan"

          - script: terraform apply -auto-approve tfplan
            displayName: "Terraform Apply"

